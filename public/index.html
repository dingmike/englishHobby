<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/1.1.2/weui.min.css">
    <script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.3.0.js"></script>
    <script type="text/javascript" src="https://res.wx.qq.com/open/libs/weuijs/1.1.3/weui.min.js"></script>
    <script type="text/javascript" src="./js/jquery-3.3.1.min.js"></script>
    <style>
        .container{
            padding: 10px;
        }
        .login-btn{
            padding: 76px 0;
        }
    </style>
</head>
<body>
<div class="container">

    <div class="weui-msg">
        <!--<div class="weui-msg__icon-area"><i class="weui-icon-success weui-icon_msg"></i></div>-->
        <div class="weui-msg__text-area">
            <h2 class="weui-msg__title">English Hobby</h2>
            <p class="weui-msg__desc">Let's study!</p>
        </div>
        <div class="weui-msg__opr-area">
            <p class="weui-btn-area">
                <a id="toWechat" href="" class="weui-btn weui-btn_primary">微信用户一键登录</a>
            </p>
        </div>
        <div class="weui-msg__extra-area">
            <div class="weui-footer">
                <!-- <p class="weui-footer__links">
                     <a href="http://www.tecfcs.com" class="weui-footer__link">tecfcs.com</a>
                 </p>-->
                <p class="weui-footer__text">Copyright © 2008-2018 <a href="http://www.tecfcs.com">tecfcs.com</a></p>
            </div>
        </div>
    </div>
</div>

<script>
  //
        $(function () {

            const HOST = 'http://newscnn.tunnel.qydev.com/';
            var alink = encodeURI('http://newscnn.tunnel.qydev.com/');
            var scopeInfo ='snsapi_userinfo'; //snsapi_userinfo :获取用户基本信息，snsapi_base：用户openid
            var wcAlink = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx83a881064cf3448a&redirect_uri=' + alink + '&response_type=code&scope='+ scopeInfo +'&state=123#wechat_redirect"'
            document.getElementById('toWechat').setAttribute('href',wcAlink);

            var wxCode =GetUrlParam('code');
            if(wxCode){
                weui.alert('wxCode: ' + wxCode);

                $.ajax({
                    method: 'post',
                    url: HOST + 'wechat/wxLogin',
                    data: {
                        code: wxCode
                    },
                    success: function( res ) {
                        alert(res.data)
                    }
                });

            }


        })


     function GetUrlParam(paraName) {
        var url = document.location.toString();
        var arrObj = url.split("?");
        if (arrObj.length > 1) {
            var arrPara = arrObj[1].split("&");
            var arr;
            for (var i = 0; i < arrPara.length; i++) {
                arr = arrPara[i].split("=");
                if (arr != null && arr[0] == paraName) {
                    return arr[1];
                }
            }
            return "";
        }
        else {
            return "";
        }
    }
</script>
</body>
</html>